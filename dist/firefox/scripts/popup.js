!function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function onGetProgramDetailsResponse(response,hasPartnership){console.log("in on get program response",response),response.programDetails&&response.programDetails.programId?(setProgramDetails(response.programDetails),hasPartnership&&popuplateLink(response.programDetails.programId),show(programSection)):hide(programSection)}function hide(htmlElement){htmlElement.classList.add("hidden")}function show(htmlElement){htmlElement.classList.remove("hidden")}function setProgramDetails(programDetails){console.log("programDetails",programDetails),programId.setAttribute("value",programDetails.programId?programDetails.programId:""),programName.innerText=programDetails.programTitle?programDetails.programTitle:""}function popuplateLink(programId){console.log("pop deeplink",programId),_storage2["default"].get(["programsWithDeeplink","publisherId","countryPlatform"],function(storageResult){if(!storageResult.hasOwnProperty("programsWithDeeplink")&&!storageResult.hasOwnProperty("publisherId")&&!storageResult.hasOwnProperty("countryPlatform"))return hide(getTrackingLink),void hide(getDeeplink);var deeplinkInfo=storageResult.programsWithDeeplink.find(function(entry){return entry.programId===programId&&""!==entry.platform});if(console.log("found deeplink info",deeplinkInfo),deeplinkInfo){console.log("gen deeplink");var url=generateDeeplink(storageResult.publisherId,deeplinkInfo);linkInput.setAttribute("value",url),hide(getTrackingLink),hide(noDeeplinkSupport),show(getDeeplink)}else{console.log("gen default link");var _url=generateDefaultTextLink(storageResult.publisherId,programId,storageResult.countryPlatform);linkInput.setAttribute("value",_url),show(getTrackingLink),show(noDeeplinkSupport),hide(getDeeplink)}})}function generateDeeplink(publisherId,deeplinkInfo){var params=deeplinkInfo.params,trackingLink=deeplinkInfo.trackingLink,deeplinkParser=document.createElement("a");deeplinkParser.href=currentUrl,""!==params&&(deeplinkParser.search.indexOf("?")===-1?deeplinkParser.search+="?"+params:deeplinkParser.search+="&"+params);var finalUrl=deeplinkParser.href;return deeplinkInfo.hasOwnProperty("programId")&&"2950"===deeplinkInfo.programId&&(finalUrl=finalUrl.replace(/^https?:\/\/.*otto\.de\//,"/")),deeplinkInfo.hasOwnProperty("redirector")&&""!==deeplinkInfo.redirector&&(finalUrl=deeplinkInfo.hasOwnProperty("urlencodeRedirectorUrl")&&"true"!==deeplinkInfo.urlencodeRedirectorUrl?deeplinkInfo.redirector+finalUrl:deeplinkInfo.redirector+encodeURIComponent(finalUrl)),trackingLink=trackingLink.replace("[deeplink]",encodeURIComponent(finalUrl)),trackingLink=trackingLink.replace("[ref]",publisherId),trackingLink=trackingLink.replace("[paramforwarding]","")}function generateDefaultTextLink(publisherId,programId,countryPlatform){console.log(publisherId,programId,countryPlatform);var link="http://"+getHostnameForPlatform(countryPlatform)+"/click.asp";return link+="?site="+programId,link+="&ref="+publisherId,link+="&type=text&tnb=1"}function getHostnameForPlatform(countryPlatform){switch(countryPlatform){case"DE":case"AT":case"CH":return"partners.webmasterplan.com";case"UK":return"being.successfultogether.co.uk";case"FR":return"clic.reussissonsensemble.fr";case"NL":return"zijn.samenresultaat.nl";default:return console.error("No platform identifier given"),"partners.webmasterplan.com"}}var _ext=require("./utils/ext"),_ext2=_interopRequireDefault(_ext),_storage=require("./utils/storage"),_storage2=_interopRequireDefault(_storage),popup=document.getElementById("app"),programId=document.getElementById("programId"),programName=document.getElementById("programName"),errorSection=document.getElementById("errorSection"),programSection=document.getElementById("shopSection"),linkSection=document.getElementById("linkSection"),linkInput=document.getElementById("linkInput"),copyLink=document.getElementById("copyLink"),shortenLink=document.getElementById("shortenLink"),statisticSection=document.getElementById("statisticSection"),footerSection=document.getElementById("toolsSection"),applyNow=document.getElementById("applyNow"),getCreatives=document.getElementById("getCreatives"),getVouchers=document.getElementById("getVouchers"),getTrackingLink=document.getElementById("getTrackingLink"),getDeeplink=document.getElementById("getDeeplink"),noDeeplinkSupport=document.getElementById("noDeeplinkSupport"),confirmedText=document.getElementById("confirmedText"),openText=document.getElementById("openText"),cancelledText=document.getElementById("cancelledText"),translateHtmlElements=document.getElementsByClassName("translateHtml"),currentUrl="";hide(programSection),hide(linkSection),hide(statisticSection),hide(footerSection),show(errorSection),_ext2["default"].tabs.query({active:!0,currentWindow:!0},function(tabs){tabs.length&&tabs[0].url&&(currentUrl=tabs[0].url,_ext2["default"].browserAction.getBadgeText({tabId:tabs[0].id},function(result){return"i"!==result?void hide(programSection):void _ext2["default"].browserAction.getBadgeBackgroundColor({tabId:tabs[0].id},function(badgeColorResult){var hasPartnership=!1;222!==badgeColorResult[0]&&28!==badgeColorResult[1]&&(hasPartnership=!0),_ext2["default"].runtime.sendMessage({action:"get-programDetails"},function(response){onGetProgramDetailsResponse(response,hasPartnership),hasPartnership===!1?(show(applyNow),hide(getCreatives),hide(getVouchers),hide(getTrackingLink),hide(noDeeplinkSupport),hide(getDeeplink)):(hasPartnership=!0,show(programSection),hide(applyNow),hide(getTrackingLink),hide(getDeeplink),hide(noDeeplinkSupport))})})}))}),_storage2["default"].get(["confirmed","open","cancelled","publisherId","webservicePassword","countryPlatform"],function(response){response.confirmed&&(confirmedText.innerText=response.confirmed,show(statisticSection),show(footerSection)),response.open&&(openText.innerText=response.open,show(statisticSection),show(footerSection)),response.cancelled&&(cancelledText.innerText=response.cancelled,show(statisticSection),show(footerSection)),response.publisherId&&response.webservicePassword&&response.countryPlatform&&hide(errorSection)}),popup.addEventListener("click",function(e){return e.preventDefault(),e.target&&(console.log(e.target),e.target.matches(".linksettings")?_ext2["default"].runtime.sendMessage({action:"open-page",data:{page:"settings"}}):e.target.matches(".linklogo")?_ext2["default"].runtime.sendMessage({action:"open-link",data:{link:"https://www.affili.net/"}}):e.target.matches(".linknews")?_ext2["default"].runtime.sendMessage({action:"open-page",data:{page:"news"}}):e.target.matches(".linkstatistics")?_ext2["default"].runtime.sendMessage({action:"open-page",data:{page:"orders"}}):e.target.matches(".linkapplyNow")?_ext2["default"].runtime.sendMessage({action:"open-page",data:{page:"applynow/"+programId.getAttribute("value")}}):e.target.matches(".linkgetCreatives")?_ext2["default"].runtime.sendMessage({action:"open-page",data:{page:"getCreatives/"+programId.getAttribute("value")}}):e.target.matches(".linkgetVouchers")?_ext2["default"].runtime.sendMessage({action:"open-page",data:{page:"getVouchers/"+programId.getAttribute("value")}}):e.target.matches(".linkgetDeeplink")||e.target.matches(".linkgetTrackingLink")?show(linkSection):e.target.matches(".linklikeList")?_ext2["default"].runtime.sendMessage({action:"open-page",data:{page:"likeList"}}):e.target.matches(".linkwidgetGenerator")?_ext2["default"].runtime.sendMessage({action:"open-page",data:{page:"widget"}}):e.target.matches(".linksearchDiscover")?_ext2["default"].runtime.sendMessage({action:"open-page",data:{page:"searchDiscover"}}):e.target.matches(".linkaddToWebsitePins")&&(_ext2["default"].runtime.sendMessage({action:"save-current-tab-in-like-list"}),_ext2["default"].runtime.sendMessage({action:"open-page",data:{page:"likeList?tab=1"}}))),!0});for(var i=0;i<translateHtmlElements.length;i++)translateHtmlElements[i].innerText=_ext2["default"].i18n.getMessage(translateHtmlElements[i].getAttribute("data-translateKey"));linkInput.addEventListener("focus",function(){this.setSelectionRange(0,this.value.length),document.execCommand("copy")}),copyLink.addEventListener("click",function(){linkInput.select(),copyLink.classList.remove("success");try{var successful=document.execCommand("copy");successful&&copyLink.classList.add("success")}catch(err){console.log("Oops, unable to copy")}}),shortenLink.addEventListener("click",function(){shortenLink.classList.remove("success"),shortenLink.classList.add("loading"),_ext2["default"].runtime.sendMessage({action:"shorten-link",data:{link:linkInput.value}},function(response){if(console.log("received answer",response),shortenLink.classList.remove("loading"),shortenLink.classList.add("success"),response!==!1){linkInput.setAttribute("value",response),linkInput.select();var successful=document.execCommand("copy");successful&&copyLink.classList.add("success")}else shortenLink.classList.remove("success"),shortenLink.classList.remove("loading")})})},{"./utils/ext":2,"./utils/storage":3}],2:[function(require,module,exports){"use strict";function Extension(){var _this=this;apis.forEach(function(api){_this[api]=null;try{chrome[api]&&(_this[api]=chrome[api])}catch(e){}try{window[api]&&(_this[api]=window[api])}catch(e){}try{browser[api]&&(_this[api]=browser[api])}catch(e){}try{_this.api=browser.extension[api]}catch(e){}});try{browser&&browser.runtime&&(this.runtime=browser.runtime)}catch(e){}try{browser&&browser.browserAction&&(this.browserAction=browser.browserAction)}catch(e){}}var apis=["alarms","bookmarks","browserAction","commands","contextMenus","cookies","downloads","events","extension","extensionTypes","history","i18n","idle","notifications","pageAction","runtime","storage","tabs","webNavigation","webRequest","windows"],ext=new Extension;module.exports=ext},{}],3:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var _ext=require("./ext"),_ext2=_interopRequireDefault(_ext),storage=_ext2["default"].storage.local;module.exports=storage},{"./ext":2}]},{},[1]);